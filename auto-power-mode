#!/bin/bash

# çŠ¶æ€ç¼“å­˜å˜é‡
LAST_STATE=""

# è‡ªåŠ¨æ£€æµ‹ AC ç”µæºè·¯å¾„
AC_ONLINE_FILE=""
for device in /sys/class/power_supply/*; do
    if [[ -f "$device/type" ]] && grep -q "Mains" "$device/type"; then
        AC_ONLINE_FILE="$device/online"
        break
    fi
done

if [[ ! -f "$AC_ONLINE_FILE" ]]; then
    notify-send "âš ï¸ ç”µæºæ£€æµ‹å¤±è´¥" "æœªæ‰¾åˆ° AC ç”µæºè®¾å¤‡"
    exit 1
fi

while true; do
    CURRENT_STATE=$(cat "$AC_ONLINE_FILE")

    if [[ "$CURRENT_STATE" != "$LAST_STATE" ]]; then
        if [[ "$CURRENT_STATE" -eq 1 ]]; then
            powerprofilesctl set balanced
            notify-send "âš¡ ç”µæºå·²æ¥å…¥" "å·²åˆ‡æ¢ä¸ºå¹³è¡¡æ¨¡å¼ï¼ˆbalancedï¼‰"
        else
            powerprofilesctl set power-saver
            notify-send "ğŸ”‹ ä½¿ç”¨ç”µæ± ä¾›ç”µ" "å·²åˆ‡æ¢ä¸ºçœç”µæ¨¡å¼ï¼ˆpower-saverï¼‰"
        fi
        LAST_STATE="$CURRENT_STATE"
    fi

    sleep 5
done

